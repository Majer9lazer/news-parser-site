@{
    ViewBag.Title = "Login";
}
<div class="container" style="margin-top: 20px;" id="loginForm">

    <div class="userInfo" style="display: none;">
        <p>Вы вошли как: <span class="userName"></span></p>
        <input type="button" value="Выйти" id="logOut" />
    </div>
    <h3>Вход на сайт</h3>
    <hr />
    <div class="row">
        <div class="form-horizontal col-md-6">

            <div class="form-group">
                <div class="col-md-2">
                    <label class="control-label" for="userLogin">Логин/Email</label>
                </div>
                <div class="col-md-10">
                    <input class="form-control" id="userLogin" type="email" v-model="userLogin" placeholder="doggyStyle@example.com" />
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-2">
                    <label class="control-label" for="userPassword">Пароль</label>
                </div>
                <div class="col-md-10">
                    <input class="form-control" id="userPassword" v-model="userPassword" type="password" placeholder="1Example.test" />
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-6">
                    <button type="button" v-on:click="signIn" class="btn btn-primary">
                        Войти
                    </button>
                    <button type="button" v-on:click="logout" class="btn btn-primary">
                        Выйти
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="alert alert-dismissible" v-show="!waitingForProcess" v-bind:class="alertClass" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <span>
            {{messageInfo}}
        </span>
    </div>
    <div class="row" v-show="waitingForProcess">
        <div class="col-xs-6 col-md-3">
            <a href="#" class="thumbnail">
                <img src="~/Content/gif/JointRevolvingAntelopegroundsquirrel-size_restricted.gif" alt="loader">
            </a>
        </div>
    </div>

</div>

@section scripts{
    <script>
        var formVue = new Vue({
            el: "#loginForm",
            data: {
                userLogin: 'sidorenkoegor1999@mail.ru',
                userPassword: '1Rj,kfcnm',
                errorExists: false,
                alertClass: 'alert-info',
                messageInfo: null,
                token: '',
                tokenKey: 'tokenInfo',
                waitingForProcess: false
            },
            mounted: function () {
                var token = sessionStorage.getItem(this.tokenKey);
                this.messageInfo = 'Ваш токен = ' + token;
            },
            methods: {
                signIn: function () {
                    formVue.waitingForProcess = true;
                    $.ajax({

                        type: 'POST',
                        url: '/Token',
                        data: {
                            grant_type: 'password',
                            username: this.userLogin,
                            password: this.userPassword
                        }
                    }).done(function (resp) {
                        formVue.messageInfo = 'Ваш токен = \n Bearer ' + resp.access_token;

                        sessionStorage.setItem(formVue.tokenKey, 'Bearer ' + resp.access_token);
                        formVue.token = 'Bearer ' + resp.access_token;
                        formVue.alertClass = 'alert-success';
                        console.log(resp);
                    }).fail(function (data) {
                        formVue.alertClass = 'alert-danger';
                        formVue.messageInfo = data.statusText;
                        console.log(data);
                    });
                    formVue.waitingForProcess = false;
                },
                logout: function () {
                    sessionStorage.removeItem(this.tokenKey);
                    this.token = null;
                    this.messageInfo = 'Здесь будет информация о ваших текущих действиях.';
                }
            }
        });
    </script>
}